<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Story</title>
    <style>
        body {
            display: flex;
            height: 100vh;
            margin: 0;
        }

        p {
            font-size: large;
        }

        a {
            color: #04AA6D; /* Set the text color to a specific color (e.g., blue) */
            text-decoration: none; /* Remove underlines from links */
            font-weight: bold; /* Make the text bold */
            transition: color 0.3s ease; /* Add a smooth color transition on hover */
        }

        a:hover {
            color: #1d7e5b; /* Change the text color on hover */
        }

        #left-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            border-right: 1px solid #ccc;
        }

        #upper-subsection {
            flex: 1;
            /* Add styles for the graph container */
        }

        #lower-subsection {
            /* Add styles for the unordered list */
        }

        #right-section {
            flex: 1;
            padding: 20px;
        }

        #story-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        #story-content {
            /* Add styles for the story content */
        }


        button {
            background-color: #04AA6D; /* Green */
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            width: 70%;
            cursor: pointer;
            }

            #navigation-buttons {
                position: fixed;
                bottom: 20px;
                left: 65%;
                display: flex;
            }

        #next-button {
            margin-left: auto; /* Pushes the 'Next' button to the right */
        }

        #previous-button {
            margin-right: 10px;
        }
        div.scroll {
            margin: 4px, 4px;
            padding: 4px;
            height: 80px;
            overflow-x: hidden;
            overflow-y: auto;
            text-align: justify;
        }
        div.scroll2 {
            margin: 4px, 4px;
            padding: 4px;
            height: 180px;
            overflow-x: hidden;
            overflow-y: auto;
            text-align: justify;
        }

        .image_padded {
            padding-left: 150px;
        }

        .image_non_padded {
            padding-left: 0px;
        }
    </style>
</head>
<body>
    <div id="left-section">
        <div id="upper-subsection" class="scroll">
            <!-- Add your control flow diagram here -->
            <!-- You can use a library like D3.js or Chart.js for the graph -->
            <h4>Steps</h4>
            <!-- You can load mermaid from mermaid_backup here-->
            <img id="image" src="tmp_2/graphs_kitty-7.png" alt="Image 1" class="">
        
            <script type="module">
            import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
            mermaid.initialize({ startOnLoad: true });

            const storyPages = [
            // Each element of this array represents a page in the story
            `<p> 
                This is a story about the process of making a contribution to the OSS projects.
                <br><br><br> Click next to start the story...
                </p>
            `,
            `Page:1
            <p> 
                Once upon a time in the mystical land, there lived a curious and determined girl named Kitty who was in love with books, magic and mythical creatures. 
                She stumbled upon a fascinating book about dragons and the secrets of the code-knitters and their magical spells. 
                Intrigued by the prospect of summoning her own <b>dragon</b>, Kitty delved into the world of <b>code-knitters</b>.

                </p>`,
                `
                Page:2
                <p>
                    The code-knitters, a unique species, possessed the power to create <b>spells</b> using specially arranged codes that could 
                    summon magnificent dragons. Kitty learned that these code-knitters were always on 
                    the lookout for new members to join their ranks and contribute to the summoning 
                    of even mightier dragons. They had some sort of a <b>golden book</b>. If a code-knitter 
                    was able to add a magic spell to the book, they'd be gifted a dragon.
                </p>

                <p>
                    Eager to own a dragon herself, Kitty followed the instructions in the book. 
                    First, she had to become a citizen of one of the <b>code-knitter kingdoms</b>.
                     After she decided on the kingdom she wanted to be a part of, she made a 
                     long journey and arrived at its gate. A large wooden <b>map</b> greeted her, 
                     illustrating the kingdom's layout. As she explored, Kitty discovered the
                     lively and vibrant kingdom of the code-knitters.

                </p>`,
                `
                Page:3
                <p>
                    The code-knitters had a tradition of gathering in large <b>groups</b> to discuss 
                    spells, dragons, and other magical matters. Though welcomed into the group, 
                    Kitty found it challenging to grasp the complexities of their discussions. 
                    Undeterred, she decided to navigate the new kingdom, acknowledging that some 
                    tasks would be complex.
                </p>
                `,
            `Page:4
            <p>
                Determined, Kitty sought the guidance of a master who taught new citizens. 
                The master welcomed her, providing insights into the <b>history of the codebook</b>
                and the <b>behaviors expected</b> in the kingdom. He emphasized the importance of
                 <b>understanding fellow code-knitters'</b> spells to enhance her chances of summoning
                  mightier dragons.
                </p>

                <p>
                    Venturing into the kingdom, Kitty experienced both ecstasy and nervousness. 
                    Her love for book and her curiousness drove her to the library of the kingdom.
                     There, devoured the books and discovered that even the kingdom of code-knitters
                      faced problemsâ€” <b>issues</b> in the codebook and the dragons created thus far. She also 
                      found a huge catalog of these issues.
                    

                </p>`,
                `
                Page:5
                <p>
                    Staying with the master, Kitty learned the intricacies of the kingdom. 
                    Once confident in her understanding, the master entrusted her with a <b>wooden codebook</b>, 
                    allowing her to experiment with new spells unlike the sacred golden codebook. He asked her
                     to bring the wooden codebook back if she had any working spell so that he can update 
                     the golden codebook.
                </p>`,
                `
                Page:6
                <p>
                    Most problems were deeply magical and incomprehensible, but Kitty stumbled upon 
                    a few that she could understand and solve. Excited at the prospect of obtaining 
                    her own dragon, she picked a manageable issue, consulted fellow code-knitters, and 
                    tirelessly experimented in her wooden codebook. After a long trial, it finally seemed 
                    to work, her <b>first magic spell</b>.
                </p>`,
                `
                Page:7
                    <p>
                Confident in her new spell, Kitty approached the master to <b>update the golden codebook</b>.
                 He meticulosly checked her spells and finally <b>obliged</b>, and as a result, Kitty summoned a small, exquisite <b>dragon</b>. 
                 While delighted, she aimed for something grander and set her sights on acquiring an even bigger dragon 
                 in the enchanting world of code-knitters. The journey of Kitty, the aspiring code-knitter,
                  had only just begun.
                </p>`,
            // Add more pages as needed
        ];

        const mermaidCodeArray = [
            "graph TD;A[<a href='http://google.com'>main</a>]"
            ,"graph TD;A[<a href='http://google.com'>main</a>] --> B[<a href='http://google.com'>fitness_tracker</a>];A --> C[<a href='http://google.com'>screen_tracker</a>]"
            ,"graph TD;A[<a href='http://google.com'>main</a>] --> B[<a href='http://google.com'>fitness_tracker</a>];A --> C[<a href='http://google.com'>screen_tracker</a>];B --> D[<a href='http://google.com'>exercise_tracker</a>];B --> E[<a href='http://google.com'>meal_tracker</a>]"
        ];

        
        const images = [
                'tmp_2/graphs_kitty-1.png',
                'tmp_2/graphs_kitty-2.png',
                'tmp_2/graphs_kitty-3.png',
                'tmp_2/graphs_kitty-4.png',
                'tmp_2/graphs_kitty-5.png',
                'tmp_2/graphs_kitty-6.png',
                'tmp_2/graphs_kitty-7.png',

            ];


        let currentPage = 0;

        // Display the initial story content
        document.getElementById('story-content').innerHTML = storyPages[currentPage];
        const imageElement = document.getElementById('image').innerHTML;

        // document.getElementById('mermaid').innerHTML = mermaidCodeArray[currentPage];


        // Add event listener for the 'Next' button
        document.getElementById('next-button').addEventListener('click', () => {
            if (currentPage < storyPages.length - 1) {
                const imageElement = document.getElementById('image');
                currentPage++;
                document.getElementById('story-content').innerHTML = storyPages[currentPage];

                if(currentPage==0){
                    imageElement.src = images[6];
                }
                else{
                    imageElement.src = images[currentPage-1];
                }

                if (currentIndex ==0 || currentPage>2) {
                    imageElement.className = 'image_non_padded';
                } else {
                    imageElement.className = 'image_padded';
                }

            }
        });

        // Add event listener for the 'Previous' button
        document.getElementById('previous-button').addEventListener('click', () => {
            if (currentPage > 0) {
                const imageElement = document.getElementById('image');
                currentPage--;
                document.getElementById('story-content').innerHTML = storyPages[currentPage];
                
                if(currentPage==0){
                    imageElement.src = images[6];
                }
                else{
                    imageElement.src = images[currentPage-1];
                }

                // document.getElementById('mermaid').innerHTML = mermaidCodeArray[currentPage];

            }
        });
            </script>



<script>
    function highlightText(target) {
        // Get the story paragraph element
        const storyParagraph = document.getElementById('story-content');

        // Get the text content of the story
        const storyText = storyParagraph.textContent;
        console.log(storyText)
        // Use a regular expression to find all occurrences of the target text
        const regex = new RegExp(target, 'g');
        const matches = storyText.matchAll(regex);
        console.log(matches);
        var extra_text = '';
        // Iterate over matches and apply highlighting
        for (const match of matches) {
            var start = match.index;

            var end = start + match[0].length;
            var offset = extra_text.length;

            start = start+offset;
            end = end+offset;

            console.log("Match length = ", match[0].length);
            console.log(storyParagraph.innerHTML.substring(0, start));
            console.log(storyParagraph.innerHTML.substring(end));


            // Wrap the matching text with a span element having the highlight class
            extra_text = '<span class="highlight">${}</span>';
            console.log("Substring = ", storyText.substring(start, end));
            const highlightedText = `<span class="highlight">${storyText.substring(start, end)}</span>`;


            storyParagraph.innerHTML = storyParagraph.innerHTML.substring(0, start+3) +
                highlightedText + storyParagraph.innerHTML.substring(end);

            console.log(storyParagraph.innerHTML.substring(0, start) +
                highlightedText + storyParagraph.innerHTML.substring(end));


            
        }


        // Remove highlighting after 3 seconds
        setTimeout(() => {
            const highlightedText = document.querySelectorAll('.highlight');
            highlightedText.forEach((element) => {
                element.classList.remove('highlight');
            });
        }, 3000);
    }
</script>


        </div>
        <div id="lower-subsection" class="scroll2">
            <p>Characters:</p>
            <ul>
                <li><p onclick="highlightText('Manny')">Dragon : Contribution</p></li>
                <li><p onclick="highlightText('Fitty')">Code-knitters : Developers</p></li>
                <li><p onclick="highlightText('Screeny')">Spells : Code</p></li>
                <li><p onclick="highlightText('Screeny')">Kingdom : Main repo</p></li>
                <li><p onclick="highlightText('Screeny')">Golden book : Main branch</p></li>
                <li><p onclick="highlightText('Screeny')">Map : Project structure</p></li>
                <li><p onclick="highlightText('Screeny')">Groups : Forums</p></li>
                <li><p onclick="highlightText('Screeny')">History : Changelogs</p></li>
                <li><p onclick="highlightText('Screeny')">Behaviors : Code of Conduct</p></li>
                <li><p onclick="highlightText('Screeny')">Understanding other's work : Documentation</p></li>
                <li><p onclick="highlightText('Screeny')">Wooden Book : Clone/fork</p></li>
                <li><p onclick="highlightText('Screeny')">Issues : Issues</p></li>
                <li><p onclick="highlightText('Screeny')">Update golden book : Pull Request</p></li>
                <li><p onclick="highlightText('Screeny')">Kitty's dragon : PR Merge</p></li>

                <!-- Add more clickable texts as needed -->
            </ul>
        </div>
    </div>

    <div id="right-section">
        <div id="story-title">Kitty and her dragon</div>
        <div id="story-content">

        </div>
        <div id="navigation-buttons">
            <button id="previous-button">Previous</button>
            <button id="next-button">Next</button>
        </div>
    </div>
    
</body>
</html>
