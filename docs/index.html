<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Story</title>
    <style>
        body {
            display: flex;
            height: 100vh;
            margin: 0;
        }

        p {
            font-size: large;
        }

        a {
            color: #04AA6D; /* Set the text color to a specific color (e.g., blue) */
            text-decoration: none; /* Remove underlines from links */
            font-weight: bold; /* Make the text bold */
            transition: color 0.3s ease; /* Add a smooth color transition on hover */
        }

        a:hover {
            color: #1d7e5b; /* Change the text color on hover */
        }

        #right-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            border-right: 1px solid #ccc;
        }

        #upper-subsection {
            flex: 1;
            /* Add styles for the graph container */
        }

        #lower-subsection {
            /* Add styles for the unordered list */
        }

        #left-section {
            flex: 1;
            padding: 20px;
        }

        #story-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        #story-content {
            /* Add styles for the story content */
        }


        button {
            background-color: #04AA6D; /* Green */
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            width: 70%;
            cursor: pointer;
            }

            #navigation-buttons {
                position: fixed;
                bottom: 10px;
                left: 40%;
                display: flex;
            }

        #next-button {
            margin-left: auto; /* Pushes the 'Next' button to the right */
        }

        #previous-button {
            margin-right: 10px;
        }
        div.scroll {
            margin: 4px, 4px;
            padding: 4px;
            height: 80px;
            overflow-x: auto;
            overflow-y: auto;
            text-align: justify;
             ;
        }
        div.scroll2 {
            margin: 4px, 4px;
            padding: 4px;
            height: 180px;
            overflow-x: hidden;
            overflow-y: auto;
            text-align: justify;
        }

        .image_padded {
            padding-left: 150px;
        }

        .image_non_padded {
            padding-left: 0px;
        }

        #story-image {
            max-width: 70%;
        }

        #page_image {
            max-width: 100%;
            height: auto; /* This property ensures the aspect ratio is preserved */
}
    </style>
</head>
<body onload="load_whole_graph()">
    <div id="left-section">
        <div id="story-title">Kitty and her dragon</div>
        <div id="story-content">
        </div>

        <div id="story-image">
            <img id="page_image" src="new_exports/image_10.png" alt="Image 1" class="">
        </div>

        <div id="navigation-buttons">
            <button id="previous-button">&#9665;</button>
            <button id="next-button">&#9655;</button>
        </div>
    </div>

    <div id="right-section">
        <div id="upper-subsection" class="scroll">
            <!-- Add your control flow diagram here -->
            <!-- You can use a library like D3.js or Chart.js for the graph -->
            <!-- You can load mermaid from mermaid_backup here-->
            <!-- <img id="image" alt="Image 1" class=""> -->
        
            <script type="module">
            import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
            mermaid.initialize({ startOnLoad: true });
            </script>

            <script type="text/javascript" src="story_page.js"></script>
            <script>

            const mermaidCodeArray = [
                "graph TD;A[<a href='http://google.com'>main</a>]"
                ,"graph TD;A[<a href='http://google.com'>main</a>] --> B[<a href='http://google.com'>fitness_tracker</a>];A --> C[<a href='http://google.com'>screen_tracker</a>]"
                ,"graph TD;A[<a href='http://google.com'>main</a>] --> B[<a href='http://google.com'>fitness_tracker</a>];A --> C[<a href='http://google.com'>screen_tracker</a>];B --> D[<a href='http://google.com'>exercise_tracker</a>];B --> E[<a href='http://google.com'>meal_tracker</a>]"
            ];

        
        const images = [
                'tmp_2/graphs_kitty-1.png',
                'tmp_2/graphs_kitty-2_1.png',
                'tmp_2/graphs_kitty-2_2.png',
                'tmp_2/graphs_kitty-3.png',
                'tmp_2/graphs_kitty-4_1.png',
                'tmp_2/graphs_kitty-4_2.png',
                'tmp_2/graphs_kitty-5.png',
                'tmp_2/graphs_kitty-6.png',
                'tmp_2/graphs_kitty-7.png',
                'tmp_2/graphs_kitty-8.png',
            ];

            const page_images = [
                'new_exports/image_1.png',
                'new_exports/image_2.png',
                'new_exports/image_3.png',
                'new_exports/image_4.png',
                'new_exports/image_5.png',
                'new_exports/image_6.png',
                'new_exports/image_7.png',
                'new_exports/image_8.png',
                'new_exports/image_9.png',
                'new_exports/image_10.png',
            ];


        let currentPage = 0;
        const imageElements = [];

        const addNewImage = (currentPage) => {
            const imagesContainer = document.getElementById('upper-subsection');
            const newImage = document.createElement('img');
            newImage.src = `tmp_2/actual_cuts/Image_${currentPage}.png`;
            newImage.alt = `Image ${currentPage}`;
            newImage.id = 'image';
            imagesContainer.appendChild(newImage);
            currentPage++;

            imageElements.push(newImage);
            console.log("Current graph image = ", newImage.src);
        };

        const removeLastImage=()=>{
            // Get the last added image element
            const lastImage = imageElements.pop();

            // Remove the image element from the document
            lastImage.parentNode.removeChild(lastImage);

        }

        function load_whole_graph(){
            for(let i = 1; i < 11; i++){
                if(i==6){
                            removeLastImage();
                    }
                addNewImage(i);

            }
        }

        function scrollToBottom() {
                var element = document.getElementById('upper-subsection');
                element.scrollTop = 1202;
                console.log("element scroll = ", element.scrollHeight)
            }

            function scrollToTop() {
                var element = document.getElementById('upper-subsection');
                element.scrollTop = 0;
            }

        // Display the initial story content
        document.getElementById('story-content').innerHTML = storyPages[currentPage];

        // document.getElementById('mermaid').innerHTML = mermaidCodeArray[currentPage];


        // Add event listener for the 'Next' button
        document.getElementById('next-button').addEventListener('click', () => {
            if (currentPage < storyPages.length - 1) {
                const imageElement = document.getElementById('image');
                const fiction_imageElement = document.getElementById('page_image');

                currentPage++;
                document.getElementById('story-content').innerHTML = storyPages[currentPage];

                if(currentPage==0){
                    // imageElement.src = images[9];
                    for(let i = 1; i < 10; i++){
                        addNewImage(i);
                    }
                fiction_imageElement.src = page_images[9];
                console.log("Current page = ", currentPage-1);
                console.log("Story image = ", page_images[9] );


                }
                else{
                    // console.log("Current page = ", currentPage-1);
                    // imageElement.src = images[currentPage-1];
                    // console.log("Graph image = ", images[currentPage-1] );
                    fiction_imageElement.src = page_images[currentPage-1];

                    // console.log("Story image = ", page_images[currentPage-1] );
                    //remove all extra images except the first one
                    if(currentPage==1){
                        total_elements = imageElements.length
                        // for(let i = 0; i < 5; i++){
                        //     removeLastImage();
                        // }
                        while(total_elements!=0){
                            removeLastImage();
                            total_elements--;
                        }
                    }

                    if(currentPage==6){
                            removeLastImage();
                    }

                    //add new image for current page
                    addNewImage(currentPage);
                }
                scrollToBottom();

            }
        });

        // Add event listener for the 'Previous' button
        document.getElementById('previous-button').addEventListener('click', () => {
            if (currentPage > 0) {
                const imageElement = document.getElementById('image');
                const fiction_imageElement = document.getElementById('page_image');

                currentPage--;
                document.getElementById('story-content').innerHTML = storyPages[currentPage];
                
                if(currentPage==0){
                    // imageElement.src = images[9];
                    total_elements = imageElements.length
                        // for(let i = 0; i < 5; i++){
                        //     removeLastImage();
                        // }
                        while(total_elements!=0){
                            removeLastImage();
                            total_elements--;
                        }
                    for(let i = 1; i < 11; i++){
                        if(i==6){
                                    removeLastImage();
                            }
                        addNewImage(i);

                    }
                    fiction_imageElement.src = page_images[9];

                }
                else{

                    console.log("Current page = ", currentPage-1);

                    // imageElement.src = images[currentPage-1];
                    // console.log("Graph image = ", images[currentPage-1] );

                    fiction_imageElement.src = page_images[currentPage-1];
                    console.log("Story image = ", page_images[currentPage-1] );
                    if(currentPage==1){
                        // for(let i = 0; i < 5; i++){
                        //     removeLastImage();
                        // }

                        total_elements = imageElements.length
                        // for(let i = 0; i < 5; i++){
                        //     removeLastImage();
                        // }
                        while(total_elements!=0){
                            removeLastImage();
                            total_elements--;
                        }
                        addNewImage(1);
                    }
                    // else if(currentPage==6){
                    //     removeLastImage();
                    //     removeLastImage();
                    //     addNewImage(5);
                
                    // }
                    else{
                        removeLastImage();
                    }
                }

                // document.getElementById('mermaid').innerHTML = mermaidCodeArray[currentPage];

            }
        });
            </script>

        </div>
        
    </div>
    
</body>
</html>
